---
title: "DRGs in inflammation: DGE & GSEA"
date: "`r Sys.Date()`"
output:
      html_document:
        toc: true
        toc_float: true
        number_sections: true
        collapsed: true
        fig_caption: yes
        df_print: paged
---

DGE and Gene Ontology Analysis of Dorsal Root Ganglia during Inflammation

DRGs of infected and naive Snap25CreINTACT mice were isolated. Nuclei isolation was performed and neuronal nuclei were sort-purified (GFP+). Bulk RNA-Sequencing was done and the results are shownbelow.

```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
# knitr::opts_knit$set(root.dir = "/Volumes/PortableSSD/1_PhD/1_Projects/1_Neurons/2_SeqAnalysis/1_Mine")

# load importante libraries

library("DESeq2")
library("limma")
library("gProfileR")
library("httr")
library("RJSONIO")
library(pheatmap)
library(dbplyr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(hrbrthemes)
library(viridis)
library(plotly)
library(RColorBrewer)
library(viridis)
library(readxl)
#library(DEGreport)
library(htmltools)
library(vctrs)
library(EnhancedVolcano)
library(readr)
library("topGO")
library("org.Mm.eg.db")
library("AnnotationDbi")
library("DOSE")
library("GO.db")
library("GSEABase")
library("clusterProfiler")
library("tidyr")
library("stringr")
library("rWikiPathways")
library("RCy3")
library(ReactomePA)
library(scales)
library(gridExtra)
library(grid)
library(ggrepel)
library(repr)
library(ggpubr)
library(knitr)
library(kableExtra)
library(DT)
library(xfun)
library(rmarkdown)
library(patchwork)
library(readr)
library(gprofiler2)
library(ggplot2)
library(gt)
library(gtExtras)
```

```{r Import data, echo=FALSE,warning=FALSE,message = FALSE}

### counts
#
# counts.drg <- as.data.frame(read_excel("DRG/Counts/DRG_Counts.xlsx"))
# counts.drg <- as.data.frame(read_excel("DRG/Counts/DRG_Counts.xlsx"))
# counts.smg <- as.data.frame(read_excel("SMG/Counts/SMG_Counts.xlsx"))
# counts.vg <- as.data.frame(read_excel("VG/Counts/VG_Counts.xlsx"))


#### norm counts

Neurons_NormCounts_symbol <- read_csv("../data/processed/Neurons_NormCounts_symbol.csv")
nc <- as.data.frame(Neurons_NormCounts_symbol)
nc <- unique(nc)
nc <- nc[!duplicated(nc$gene_name),]
nc <- na.omit(nc)
rownames(nc) <- nc$gene_name


### DESeq2


drg.nippo <- read_excel("../data/processed/DRG_DESeq2_Nippo.xlsx")
drg.dss <- read_excel("../data/processed/DRG_DESeq2_DSS.xlsx")
drg.th17 <- read_excel("../data/processed/DRG_DESeq2_Th17.xlsx")


## for Volcano

drg.nippo.v <- read.delim("../data/raw/DESeq2_DRG_Nippo_results.tabular", header=F)
drg.dss.v <- read.delim("../data/raw/DESeq2_DRG_DSS_results.tabular", header=F)
drg.th17.v <- read.delim("../data/raw/DESeq2_DRG_Th17_results.tabular", header=F)


colnames(drg.nippo.v) <- c("GeneID","BaseMEan","Log2FC","StdErr","WaldStat","pval","padj")
colnames(drg.dss.v) <- c("GeneID","BaseMEan","Log2FC","StdErr","WaldStat","pval","padj")
colnames(drg.th17.v) <- c("GeneID","BaseMEan","Log2FC","StdErr","WaldStat","pval","padj")


anno_df <- data.frame(GeneID = drg.nippo.v$GeneID, stringsAsFactors = FALSE)
anno_df$GeneName <- mapIds(org.Mm.eg.db,
                            keys = anno_df$GeneID,
                            column = "SYMBOL",
                            keytype = "ENSEMBL",
                            multiVals = "first")
drg.nippo.v <- merge(drg.nippo.v, anno_df, by = "GeneID", all=TRUE)

anno_df <- data.frame(GeneID = drg.dss.v$GeneID, stringsAsFactors = FALSE)
anno_df$GeneName <- mapIds(org.Mm.eg.db,
                            keys = anno_df$GeneID,
                            column = "SYMBOL",
                            keytype = "ENSEMBL",
                            multiVals = "first")
drg.dss.v <- merge(drg.dss.v, anno_df, by = "GeneID", all=TRUE)

anno_df <- data.frame(GeneID = drg.th17.v$GeneID, stringsAsFactors = FALSE)
anno_df$GeneName <- mapIds(org.Mm.eg.db,
                            keys = anno_df$GeneID,
                            column = "SYMBOL",
                            keytype = "ENSEMBL",
                            multiVals = "first")
drg.th17.v <- merge(drg.th17.v, anno_df, by = "GeneID", all=TRUE)


```

# DESeq2

## Results {.tabset}
### Nippo
```{r DGESeq2 Results Nippo, echo=FALSE, paged.print=TRUE, results='asis',warning=FALSE}


drg.nippo <- na.omit(drg.nippo)
drg.nippo <- transform(drg.nippo, pvalue=sapply(pvalue, formatC, format = "e", digits=3))
drg.nippo <- transform(drg.nippo, padj=sapply(padj, formatC, format = "e", digits=3))
drg.nippo <-drg.nippo  %>% mutate_at(vars("BaseMean", "Log2FC", "StdErr", "Wald-Stats"), funs(round(., 3)))


drg.nippo %>%
  gt() %>%
  tab_header(
    title = 'DGE: DRG Nippo vs Naive',
    subtitle = 'DESeq2 Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )

```

### DSS

```{r DGESeq2 Results DSS, echo=FALSE, paged.print=TRUE, results='asis',warning=FALSE}


drg.dss <- na.omit(drg.dss)
drg.dss <- transform(drg.dss, pvalue=sapply(pvalue, formatC, format = "e", digits=3))
drg.dss <- transform(drg.dss, padj=sapply(padj, formatC, format = "e", digits=3))
drg.dss <-drg.dss  %>% mutate_at(vars("BaseMean", "Log2FC", "StdErr", "Wald-Stats"), funs(round(., 3)))


drg.dss %>%
  gt() %>%
  tab_header(
    title = 'DGE: DRG DSS vs Naive',
    subtitle = 'DESeq2 Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )

```

### Th17

```{r DGESeq2 Results th17, echo=FALSE, paged.print=TRUE, results='asis',warning=FALSE}


drg.th17 <- na.omit(drg.th17)
drg.th17 <- transform(drg.th17, pvalue=sapply(pvalue, formatC, format = "e", digits=3))
drg.th17 <- transform(drg.th17, padj=sapply(padj, formatC, format = "e", digits=3))
drg.th17 <-drg.th17  %>% mutate_at(vars("BaseMean", "Log2FC", "StdErr", "Wald-Stats"), funs(round(., 3)))


drg.th17 %>%
  gt() %>%
  tab_header(
    title = 'DGE: DRG Th17 vs Naive',
    subtitle = 'DESeq2 Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )

```


<br>

## Volcano Plots {.tabset}

```{r Volcano Plots, echo=FALSE, warning=FALSE, message = FALSE}

######## nippo

drg.nippo.v <- na.omit(drg.nippo.v)

top_up <- drg.nippo.v[drg.nippo.v$Log2FC > 1.5 & drg.nippo.v$padj < 0.05,]
top_up <- top_up[order(-top_up$Log2FC),]

top_down <- drg.nippo.v[drg.nippo.v$Log2FC < -1.5 & drg.nippo.v$padj < 0.05,]
top_down <- top_down[order(top_down$Log2FC),]


top <- c(top_up[1:50,"GeneName"],top_down[1:50,"GeneName"])


V.nippo <- EnhancedVolcano(drg.nippo.v,
                      lab = drg.nippo.v$GeneName,
                      selectLab = c(top),
                      #boxedLabels = TRUE,
                      #parseLabels = TRUE,
                      drawConnectors = TRUE,
                      widthConnectors = 0.25,
                      colConnectors = c("black"),
                      x = 'Log2FC',
                      y = 'pval',
                      title = 'DRG: Nippo vs Naive',
                      xlim = c(-10,10),
                      ylim = c(0,40),
                      pCutoff = 0.05,
                      FCcutoff = 0.5,
                      pointSize = 1.5,
                      labSize = 3.5,
                      col = c('#3e3e40', '#3e3e40', '#3e3e40',"#0066a1"),
                      gridlines.major = FALSE,
                      gridlines.minor = FALSE)


######## DSS

drg.dss.v <- na.omit(drg.dss.v)

top_up <- drg.dss.v[drg.dss.v$Log2FC > 1.5 & drg.dss.v$padj < 0.05,]
top_up <- top_up[order(-top_up$Log2FC),]

top_down <- drg.dss.v[drg.dss.v$Log2FC < -1.5 & drg.dss.v$padj < 0.05,]
top_down <- top_down[order(top_down$Log2FC),]


top <- c(top_up[1:50,"GeneName"],top_down[1:50,"GeneName"])


V.dss <- EnhancedVolcano(drg.dss.v,
                      lab = drg.dss.v$GeneName,
                      selectLab = c(top),
                      #boxedLabels = TRUE,
                      #parseLabels = TRUE,
                      drawConnectors = TRUE,
                      widthConnectors = 0.25,
                      colConnectors = c("black"),
                      x = 'Log2FC',
                      y = 'pval',
                      title = 'DRG: DSS vs Naive',
                      xlim = c(-10,10),
                      ylim = c(0,40),
                      pCutoff = 0.05,
                      FCcutoff = 0.5,
                      pointSize = 1.5,
                      labSize = 3.5,
                      col = c('#3e3e40', '#3e3e40', '#3e3e40',"red"),
                      gridlines.major = FALSE,
                      gridlines.minor = FALSE)


######## Th17

drg.th17.v <- na.omit(drg.th17.v)

top_up <- drg.th17.v[drg.th17.v$Log2FC > 1.5 & drg.th17.v$padj < 0.05,]
top_up <- top_up[order(-top_up$Log2FC),]

top_down <- drg.th17.v[drg.th17.v$Log2FC < -1.5 & drg.th17.v$padj < 0.05,]
top_down <- top_down[order(top_down$Log2FC),]


top <- c(top_up[1:50,"GeneName"],top_down[1:50,"GeneName"])


V.th17 <- EnhancedVolcano(drg.th17.v,
                      lab = drg.th17.v$GeneName,
                      selectLab = c(top),
                      #boxedLabels = TRUE,
                      #parseLabels = TRUE,
                      drawConnectors = TRUE,
                      widthConnectors = 0.25,
                      colConnectors = c("black"),
                      x = 'Log2FC',
                      y = 'pval',
                      title = 'DRG: Th17 vs Naive',
                      xlim = c(-10,10),
                      ylim = c(0,40),
                      pCutoff = 0.05,
                      FCcutoff = 0.5,
                      pointSize = 1.5,
                      labSize = 3.5,
                      col = c('#3e3e40', '#3e3e40', '#3e3e40',"darkgreen"),
                      gridlines.major = FALSE,
                      gridlines.minor = FALSE)


```

```{r enhancedVolcano plot, message = FALSE, echo=FALSE, warning=FALSE, fig.height=12,fig.width=25, fig.fullwidth=TRUE}

ggarrange(V.nippo, V.dss, V.th17, ncol=3, nrow=1)

```
<br><br><br><br>

Gene Lists are filtered for Log2FoldChange: upregulated \> 1.5 & downregulated \< -1.5 and padj \< 0.05 For Analysis, gene symbols were used, and ordered query was performed

# GSEA

## gProfiler Enrichment Analysis {.tabset}

```{r GSEA with  gProfiler, message = FALSE, echo=FALSE, warning=FALSE, results='hide'}

## DRG Nippo

drg.nippo <- drg.nippo[drg.nippo$BaseMean > 30, ]

up.genes <- drg.nippo[drg.nippo$Log2FC > 1.5, ]
up.genes.ordered <- up.genes[order(up.genes$Log2FC, decreasing = TRUE),]

dn.genes <- drg.nippo[drg.nippo$Log2FC < -1.5, ]
dn.genes.ordered <- dn.genes[order(up.genes$Log2FC, decreasing = FALSE),]

multi_gp_drg_nippo = gost(list("up-regulated" = up.genes.ordered$gene_name,
                     "down-regulated" = dn.genes.ordered$gene_name),organism = "mmusculus", ordered_query = TRUE)

gp_drg_nippo <- gostplot(multi_gp_drg_nippo, interactive = TRUE)

## DSS

drg.dss<- drg.dss[drg.dss$BaseMean > 30, ]

up.genes <- drg.dss[drg.dss$Log2FC > 1.5, ]
up.genes.ordered <- up.genes[order(up.genes$Log2FC, decreasing = TRUE),]

dn.genes <- drg.dss[drg.dss$Log2FC < -1.5, ]
dn.genes.ordered <- dn.genes[order(up.genes$Log2FC, decreasing = FALSE),]


multi_gp_drg_dss = gost(list("up-regulated" = up.genes.ordered$gene_name,
                     "down-regulated" = dn.genes.ordered$gene_name),organism = "mmusculus", ordered_query = TRUE)



gp_drg_dss <- gostplot(multi_gp_drg_dss, interactive = TRUE)

## Th17

drg.th17 <- drg.th17[drg.th17$BaseMean > 30, ]

up.genes <- drg.th17[drg.th17$Log2FC > 1.5, ]
up.genes.ordered <- up.genes[order(up.genes$Log2FC, decreasing = TRUE),]

dn.genes <- drg.th17[drg.th17$Log2FC < -1.5, ]
dn.genes.ordered <- dn.genes[order(up.genes$Log2FC, decreasing = FALSE),]


multi_gp_drg_th17 = gost(list("up-regulated" = up.genes.ordered$gene_name,
                     "down-regulated" = dn.genes.ordered$gene_name),organism = "mmusculus", ordered_query = TRUE)



gp_drg_th17 <- gostplot(multi_gp_drg_th17, interactive = TRUE)


```

### Nippo

```{r gProfiler nippo plot, message = FALSE, echo=FALSE, warning=FALSE}

ggplotly(gp_drg_nippo)

```

<br>

```{r gProfiler nippo, message = FALSE, echo=FALSE, warning=FALSE}


gp_drg_nippo_table <- multi_gp_drg_nippo[["result"]]
gp_drg_nippo_table <- transform(gp_drg_nippo_table, p_value=sapply(p_value, formatC, format = "e", digits=3))
gp_drg_nippo_table <- gp_drg_nippo_table %>% mutate_at(vars("precision","recall"), funs(round(., 3)))
gp_drg_nippo_table <- subset(gp_drg_nippo_table, select=-c(2))
table_drg_nippo <- gp_drg_nippo_table[,c("term_id","term_name","source","query","p_value","term_size","query_size","intersection_size","precision","effective_domain_size","parents")]

table_drg_nippo %>%
  gt() %>%
  tab_header(
    title = 'DRG Nippo vs Naive',
    subtitle = 'gProfiler Analysis'
  ) %>%
  cols_label(
   term_id = "Term ID",
   term_name = "Term Name",
   source = "Source",
   query = "Up/Down",
   p_value = "P-Value",
   term_size = "Term Size",
   query_size = "Query Size",
   intersection_size = "Intersection Size",
   precision = "Precision",
   effective_domain_size = "Effective Domain Size",
   parents = "Parents"
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )%>%
  cols_width(
    term_name ~ px(350)
  )



```

<br><br>

### DSS

```{r gProfiler dss plot, message = FALSE, echo=FALSE, warning=FALSE}

ggplotly(gp_drg_dss)

```

<br>

```{r gProfiler dss, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

gp_drg_dss_table <- multi_gp_drg_dss[["result"]]
gp_drg_dss_table <- transform(gp_drg_dss_table, p_value=sapply(p_value, formatC, format = "e", digits=3))
gp_drg_dss_table <- gp_drg_dss_table %>% mutate_at(vars("precision","recall"), funs(round(., 3)))
gp_drg_dss_table <- subset(gp_drg_dss_table, select=-c(2))
table_drg_dss <- gp_drg_dss_table[,c("term_id","term_name","source","query","p_value","term_size","query_size","intersection_size","precision","effective_domain_size","parents")]

table_drg_dss %>%
  gt() %>%
  tab_header(
    title = 'DRG DSS vs Naive',
    subtitle = 'gProfiler Analysis'
  ) %>%
  cols_label(
   term_id = "Term ID",
   term_name = "Term Name",
   source = "Source",
   query = "Up/Down",
   p_value = "P-Value",
   term_size = "Term Size",
   query_size = "Query Size",
   intersection_size = "Intersection Size",
   precision = "Precision",
   effective_domain_size = "Effective Domain Size",
   parents = "Parents"
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )%>%
  cols_width(
    term_name ~ px(350)
  )


```

<br><br>


### Th17

```{r gProfiler Th17 plot, message = FALSE, echo=FALSE, warning=FALSE}

ggplotly(gp_drg_th17)

```

<br>

```{r Result th17 , echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

gp_drg_th17_table <- multi_gp_drg_th17[["result"]]
gp_drg_th17_table <- transform(gp_drg_th17_table, p_value=sapply(p_value, formatC, format = "e", digits=3))
gp_drg_th17_table <- gp_drg_th17_table %>% mutate_at(vars("precision","recall"), funs(round(., 3)))
gp_drg_th17_table <- subset(gp_drg_th17_table, select=-c(2))
table_drg_th17 <- gp_drg_th17_table[,c("term_id","term_name","source","query","p_value","term_size","query_size","intersection_size","precision","effective_domain_size","parents")]

table_drg_th17 %>%
  gt() %>%
  tab_header(
    title = 'DRG Th17 vs Naive',
    subtitle = 'gProfiler Analysis'
  ) %>%
  cols_label(
   term_id = "Term ID",
   term_name = "Term Name",
   source = "Source",
   query = "Up/Down",
   p_value = "P-Value",
   term_size = "Term Size",
   query_size = "Query Size",
   intersection_size = "Intersection Size",
   precision = "Precision",
   effective_domain_size = "Effective Domain Size",
   parents = "Parents"
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )%>%
  cols_width(
    term_name ~ px(350)
  )



```


<br> <br> <br>

## clusterProfiler Enrichment Analysis {.tabset}

```{r GSEA with cluster Profiler, message = FALSE, echo=FALSE, warning=FALSE, results='hide'}

###### DRG #################################


### NIPPO ###

## gene list for upregulated genes
up.genes <- drg.nippo[drg.nippo$Log2FC > 1.5, ]
up.genes.entrez <- bitr(up.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)
## gene list for downregulated genes
dn.genes <- drg.nippo[drg.nippo$Log2FC < -1.5, ]
dn.genes.entrez <- bitr(dn.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)
## backbone gene list (all genes)
bkgd.genes <- Neurons_NormCounts_symbol$GeneID
bkgd.genes.entrez <- bitr(bkgd.genes,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)


##  https://learn.gencore.bio.nyu.edu/rna-seq-analysis/gene-set-enrichment-analysis/  #####

ego_up_drg_nippo <- clusterProfiler::enrichGO(
  gene     = up.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)


ego_dn_drg_nippo <- clusterProfiler::enrichGO(
  gene     = dn.genes.entrez[[2]],
  universe = bkgd.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)

GO_up_drg_nippo <- as.data.frame(ego_up_drg_nippo)
GO_up_drg_nippo$query <- c("up-regulated")

GO_down_drg_nippo <- as.data.frame(ego_dn_drg_nippo)
GO_down_drg_nippo$query <- c("down-regulated")



### DSS ###

## gene list for upregulated genes
up.genes <- drg.dss[drg.dss$Log2FC > 1.5, ]
up.genes.entrez <- bitr(up.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)
## gene list for downregulated genes
dn.genes <- drg.dss[drg.dss$Log2FC < -1.5, ]
dn.genes.entrez <- bitr(dn.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)


##  https://learn.gencore.bio.nyu.edu/rna-seq-analysis/gene-set-enrichment-analysis/  #####

ego_up_drg_dss <- clusterProfiler::enrichGO(
  gene     = up.genes.entrez[[2]],
  universe = bkgd.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)



ego_dn_drg_dss <- clusterProfiler::enrichGO(
  gene     = dn.genes.entrez[[2]],
  universe = bkgd.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)


GO_up_drg_dss <- as.data.frame(ego_up_drg_dss)
GO_up_drg_dss$query <- c("up-regulated")

GO_up_drg_dss

GO_down_drg_dss <- as.data.frame(ego_dn_drg_dss)
GO_down_drg_dss$query <- c("down-regulated")

### Th17 ###

## gene list for upregulated genes
up.genes <- drg.th17[drg.th17$Log2FC > 1.5, ]
up.genes.entrez <- bitr(up.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)
## gene list for downregulated genes
dn.genes <- drg.th17[drg.th17$Log2FC < -1.5, ]
dn.genes.entrez <- bitr(dn.genes$GeneID,fromType = "ENSEMBL",toType = "ENTREZID",OrgDb = org.Mm.eg.db)


##  https://learn.gencore.bio.nyu.edu/rna-seq-analysis/gene-set-enrichment-analysis/  #####

ego_up_drg_th17 <- clusterProfiler::enrichGO(
  gene     = up.genes.entrez[[2]],
  universe = bkgd.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)



ego_dn_drg_th17 <- clusterProfiler::enrichGO(
  gene     = dn.genes.entrez[[2]],
  universe = bkgd.genes.entrez[[2]],
  OrgDb    = org.Mm.eg.db,
  ont      = "ALL",
  minGSSize = 3,
  maxGSSize = 800,
  pAdjustMethod = "fdr",
  pvalueCutoff = 0.05, #p.adjust cutoff (https://github.com/GuangchuangYu/clusterProfiler/issues/104)
  readable = TRUE)


GO_up_drg_th17 <- as.data.frame(ego_up_drg_th17)
GO_up_drg_th17$query <- c("up-regulated")

GO_down_drg_th17 <- as.data.frame(ego_dn_drg_th17)
GO_down_drg_th17$query <- c("down-regulated")

```

```{r GSEA with cluster Profiler enrichGO, message = FALSE, echo=FALSE, warning=FALSE}


gg_up_drg_nippo <- dotplot(ego_up_drg_nippo, showCategory=10) + ggtitle("DRG Nippo - UP") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))
gg_dn_drg_nippo <- dotplot(ego_dn_drg_nippo, showCategory=10) + ggtitle("DRG Nippo - DOWN") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))

gg_up_drg_dss <- dotplot(ego_up_drg_dss, showCategory=10) + ggtitle("DRG DSS - UP") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))
gg_dn_drg_dss <- dotplot(ego_dn_drg_dss, showCategory=10) + ggtitle("DRG DSS - DOWN") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))

gg_up_drg_th17 <- dotplot(ego_up_drg_th17, showCategory=10) + ggtitle("DRG Th17 - UP") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))
gg_dn_drg_th17 <- dotplot(ego_dn_drg_th17, showCategory=10) + ggtitle("DRG Th17 - DOWN") + scale_y_discrete(labels = function(x) str_wrap(x, width = 50))


```

### Nippo

```{r, GO Plots 1Nippo, echo=FALSE, warning=FALSE, fig.height=6, fig.width=14, fig.fullwidth=TRUE}
grid.arrange(gg_up_drg_nippo, gg_dn_drg_nippo , ncol=2, nrow = 1)
# goplot(egobp_dn)

```

<br>

```{r GO Result nippo, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}


GO_drg_nippo <- rbind(GO_up_drg_nippo, GO_down_drg_nippo)

GO_drg_nippo %>%
  gt() %>%
  tab_header(
    title = 'DRG Nippo vs Naive',
    subtitle = 'clusterProfiler Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(350)
  )
```

<br><br>


### DSS

```{r, GO Plots DSS, echo=FALSE, warning=FALSE, fig.height=6, fig.width=14, fig.fullwidth=TRUE}

grid.arrange(gg_up_drg_dss, gg_dn_drg_dss , ncol=2, nrow = 1)

```

<br>

```{r GO Result dss, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}


GO_drg_dss <- rbind(GO_up_drg_dss, GO_down_drg_dss)

GO_drg_dss %>%
  gt() %>%
  tab_header(
    title = 'DRG DSS vs Naive',
    subtitle = 'clusterProfiler Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(350)
  )

```

<br><br>

### Th17

```{r, GO Plots 1Th17, echo=FALSE, warning=FALSE, fig.height=6, fig.width=14, fig.fullwidth=TRUE}
grid.arrange(gg_up_drg_th17, gg_dn_drg_th17 , ncol=2, nrow = 1)
# goplot(egobp_dn)

```

<br>

```{r GO Result th17, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}


GO_drg_th17 <- rbind(GO_up_drg_th17, GO_down_drg_th17)

GO_drg_th17 %>%
  gt() %>%
  tab_header(
    title = 'DRG Th17 vs Naive',
    subtitle = 'clusterProfiler Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(350)
  )

```

<br> <br> <br>


```{r GSE with cluster Profiler KEGG WikiPathways Reactome, message = FALSE, echo=FALSE, warning=FALSE}

######### DRG ############

## NIPPO ##

# we want the log2 fold changes
original_gene_list <- drg.nippo$Log2FC
# name the vector
names(original_gene_list) <- drg.nippo$GeneID
# omit any NA values
gene_list<-na.omit(original_gene_list)
# sort the list in decreasing order (required for clusterProfiler)
gene_list = sort(gene_list, decreasing = TRUE)


# Convert gene IDs for gseKEGG function
# We will lose some genes here because not all IDs will be converted
ids<-bitr(names(original_gene_list), fromType = "ENSEMBL", toType = "ENTREZID", OrgDb=org.Mm.eg.db)
# remove duplicate IDS (here I use "ENSEMBL", but it should be whatever was selected as keyType)
dedup_ids = ids[!duplicated(ids[c("ENSEMBL")]),]

# Create a new dataframe df2 which has only the genes which were successfully mapped using the bitr function above
df = drg.nippo[drg.nippo$GeneID %in% dedup_ids$ENSEMBL,]

# Create a new column in df2 with the corresponding ENTREZ IDs
df$ENTREZID = dedup_ids$ENTREZID

# Create a vector of the gene unuiverse
kegg_gene_list <- df$Log2FC

# Name vector with ENTREZ ids
names(kegg_gene_list) <- df$ENTREZID

# omit any NA values
kegg_gene_list<-na.omit(kegg_gene_list)

# sort the list in decreasing order (required for clusterProfiler)
kegg_gene_list = sort(kegg_gene_list, decreasing = TRUE)


kegg_organism = "mmu"

k_drg_nippo <- gseKEGG(geneList = kegg_gene_list,
               organism     = kegg_organism,
               nPerm        = 10000,
               minGSSize    = 3,
               maxGSSize    = 800,
               pvalueCutoff = 0.05,
               pAdjustMethod = "fdr",
               keyType       = "ncbi-geneid")

k_drg_nippo@result$Description <- gsub(k_drg_nippo@result$Description, pattern="\\s-\\sMus.+$", replacement="")

kt_drg_nippo <- k_drg_nippo@result

kegg_drg_nippo <- dotplot(k_drg_nippo, showCategory = 10, title = "DRG Nippo - KEGG" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) + scale_color_gradient(low="#FFB500",high="#1400FF")


## WikiPaths Nippo

w_drg_nippo <- gseWP(kegg_gene_list,
               organism = "Mus musculus")


wp_drg_nippo<- dotplot(w_drg_nippo, showCategory = 10, title = "WikiPathways: DRG - Nippo" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) +
        scale_color_gradient(low="#72E89A",high="#1400FF")

## Reactome

r_drg_nippo <- gsePathway(kegg_gene_list,
                organism = "mouse",
                pvalueCutoff = 0.2,
                pAdjustMethod = "BH",
                verbose = FALSE)


re_drg_nippo <- dotplot(r_drg_nippo, showCategory = 10, title = "REACTOME: DRG - Nippo" , split=".sign") +
        facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 50)) +
        scale_color_gradient(low="#72E89A",high="#FFB500")


## DSS ##

# we want the log2 fold change
original_gene_list <- drg.dss$Log2FC
# name the vector
names(original_gene_list) <- drg.dss$GeneID
# omit any NA values
gene_list<-na.omit(original_gene_list)
# sort the list in decreasing order (required for clusterProfiler)
gene_list = sort(gene_list, decreasing = TRUE)


# Convert gene IDs for gseKEGG function
# We will lose some genes here because not all IDs will be converted
ids<-bitr(names(original_gene_list), fromType = "ENSEMBL", toType = "ENTREZID", OrgDb=org.Mm.eg.db)
# remove duplicate IDS (here I use "ENSEMBL", but it should be whatever was selected as keyType)
dedup_ids = ids[!duplicated(ids[c("ENSEMBL")]),]

# Create a new dataframe df2 which has only the genes which were successfully mapped using the bitr function above
df = drg.dss[drg.dss$GeneID %in% dedup_ids$ENSEMBL,]

# Create a new column in df2 with the corresponding ENTREZ IDs
df$ENTREZID = dedup_ids$ENTREZID

# Create a vector of the gene unuiverse
kegg_gene_list <- df$Log2FC

# Name vector with ENTREZ ids
names(kegg_gene_list) <- df$ENTREZID

# omit any NA values
kegg_gene_list<-na.omit(kegg_gene_list)

# sort the list in decreasing order (required for clusterProfiler)
kegg_gene_list = sort(kegg_gene_list, decreasing = TRUE)


kegg_organism = "mmu"

k_drg_dss <- gseKEGG(geneList     = kegg_gene_list,
                       organism     = kegg_organism,
                       nPerm        = 10000,
                       minGSSize    = 3,
                       maxGSSize    = 800,
                       pvalueCutoff = 0.05,
                       pAdjustMethod = "fdr",
                       keyType       = "ncbi-geneid")

k_drg_dss@result$Description <- gsub(k_drg_dss@result$Description, pattern="\\s-\\sMus.+$", replacement="")

kt_drg_dss <- k_drg_dss@result

kegg_drg_dss <- dotplot(k_drg_dss, showCategory = 10, title = "KEGG: DRG - DSS" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) + scale_color_gradient(low="#FFB500",high="#1400FF")

## WikiPaths Nippo

w_drg_dss <- gseWP(kegg_gene_list,
               organism = "Mus musculus")

wp_drg_dss <- dotplot(w_drg_dss, showCategory = 10, title = "WikiPathways: DRG - DSS" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) +
        scale_color_gradient(low="#72E89A",high="#1400FF")


## Reactome

r_drg_dss <- gsePathway(kegg_gene_list,
                organism = "mouse",
                pvalueCutoff = 0.2,
                pAdjustMethod = "BH",
                verbose = FALSE)


re_drg_dss <- dotplot(r_drg_dss, showCategory = 10, title = "REACTOME: DRG - DSS" , split=".sign") +
        facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 50)) +
        scale_color_gradient(low="#72E89A",high="#FFB500")


## Th17 ##

# we want the log2 fold change
original_gene_list <- drg.th17$Log2FC
# name the vector
names(original_gene_list) <- drg.th17$GeneID
# omit any NA values
gene_list<-na.omit(original_gene_list)
# sort the list in decreasing order (required for clusterProfiler)
gene_list = sort(gene_list, decreasing = TRUE)


# Convert gene IDs for gseKEGG function
# We will lose some genes here because not all IDs will be converted
ids<-bitr(names(original_gene_list), fromType = "ENSEMBL", toType = "ENTREZID", OrgDb=org.Mm.eg.db)
# remove duplicate IDS (here I use "ENSEMBL", but it should be whatever was selected as keyType)
dedup_ids = ids[!duplicated(ids[c("ENSEMBL")]),]

# Create a new dataframe df2 which has only the genes which were successfully mapped using the bitr function above
df = drg.th17[drg.th17$GeneID %in% dedup_ids$ENSEMBL,]

# Create a new column in df2 with the corresponding ENTREZ IDs
df$ENTREZID = dedup_ids$ENTREZID

# Create a vector of the gene unuiverse
kegg_gene_list <- df$Log2FC

# Name vector with ENTREZ ids
names(kegg_gene_list) <- df$ENTREZID

# omit any NA values
kegg_gene_list<-na.omit(kegg_gene_list)

# sort the list in decreasing order (required for clusterProfiler)
kegg_gene_list = sort(kegg_gene_list, decreasing = TRUE)


kegg_organism = "mmu"

k_drg_th17 <- gseKEGG(geneList     = kegg_gene_list,
                       organism     = kegg_organism,
                       nPerm        = 10000,
                       minGSSize    = 3,
                       maxGSSize    = 800,
                       pvalueCutoff = 0.05,
                       pAdjustMethod = "fdr",
                       keyType       = "ncbi-geneid")

k_drg_th17@result$Description <- gsub(k_drg_th17@result$Description, pattern="\\s-\\sMus.+$", replacement="")

kt_drg_th17 <- k_drg_th17@result

kegg_drg_th17 <- dotplot(k_drg_th17, showCategory = 10, title = "KEGG: DRG - Th17" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) + scale_color_gradient(low="#FFB500",high="#1400FF")

## WikiPaths Nippo

w_drg_th17 <- gseWP(kegg_gene_list,
               organism = "Mus musculus")

wp_drg_th17 <- dotplot(w_drg_th17, showCategory = 10, title = "WikiPathways: DRG - Th17" , split=".sign") + facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 30)) +
        scale_color_gradient(low="#72E89A",high="#1400FF")

## Reactome

r_drg_th17 <- gsePathway(kegg_gene_list,
                organism = "mouse",
                pvalueCutoff = 0.2,
                pAdjustMethod = "BH",
                verbose = FALSE)


re_drg_th17 <- dotplot(r_drg_th17, showCategory = 10, title = "REACTOME: DRG - Th17" , split=".sign") +
        facet_grid(.~.sign) + scale_y_discrete(labels = function(x) str_wrap(x, width = 50)) +
        scale_color_gradient(low="#72E89A",high="#FFB500")




```

## KEGG {.tabset}

```{r, GO Plots KEGG_DRG, echo=FALSE, warning=FALSE, fig.height=8, fig.width=22, fig.fullwidth=TRUE}
grid.arrange(kegg_drg_nippo, kegg_drg_dss , kegg_drg_th17, ncol=3, nrow = 1)
# goplot(egobp_dn)

```

### Nippo

```{r Kegg Result nippo, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}



kt_drg_nippo %>%
  gt() %>%
  tab_header(
    title = 'DRG Nippo vs Naive',
    subtitle = 'KEGG Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  )  %>%
  cols_width(
    Description ~ px(300)
  )

```

### DSS

```{r Kegg Result dss, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}


kt_drg_dss %>%
  gt() %>%
  tab_header(
    title = 'DRG DSS vs Naive',
    subtitle = 'KEGG Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```


### Th17

```{r Kegg Result Th17, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}


kt_drg_th17 %>%
  gt() %>%
  tab_header(
    title = 'DRG Th17 vs Naive',
    subtitle = 'KEGG Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```

<br><br><br>

## WikiPathways {.tabset}

```{r, GO Plots WP_DRG, echo=FALSE, warning=FALSE, fig.height=8, fig.width=22, fig.fullwidth=TRUE}
grid.arrange(wp_drg_nippo, wp_drg_dss , wp_drg_th17, ncol=3, nrow = 1)
# goplot(egobp_dn)

```

### Nippo

```{r Wikipaths Result nippo, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

w_drg_nippo@result %>%
  gt() %>%
  tab_header(
    title = 'DRG Nippo vs Naive',
    subtitle = 'WikiPathways Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )
```

### DSS

```{r Wikipaths Result dss, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

w_drg_dss@result %>%
  gt() %>%
  tab_header(
    title = 'DRG DSS vs Naive',
    subtitle = 'WikiPathways Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```

### Th17

```{r Wikipaths Result Th17, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

w_drg_th17@result %>%
  gt() %>%
  tab_header(
    title = 'DRG Th17 vs Naive',
    subtitle = 'WikiPathways Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```
<br <br><br>

## Reactome {.tabset}

```{r, GO Plots Reactome_DRG, echo=FALSE, warning=FALSE, fig.height=8, fig.width=22, fig.fullwidth=TRUE}
grid.arrange(re_drg_nippo, re_drg_dss , re_drg_th17, ncol=3, nrow = 1)
# goplot(egobp_dn)

```

### Nippo

```{r Reactome Nippo, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

r_drg_nippo@result %>%
  gt() %>%
  tab_header(
    title = 'DRG Nippo vs Naive',
    subtitle = 'Reactome Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```

### DSS

```{r Reactome DSS, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

r_drg_dss@result %>%
  gt() %>%
  tab_header(
    title = 'DRG DSS vs Naive',
    subtitle = 'Reactome Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```

### Th17

```{r Reactome Th17, echo=FALSE, paged.print=TRUE, results='asis',fig.height=5, fig.length=20,warning=FALSE}

r_drg_th17@result %>%
  gt() %>%
  tab_header(
    title = 'DRG Th17 vs Naive',
    subtitle = 'Reactome Analysis'
  ) %>%
  tab_options(
    # These were the ones we applied in the first chapter
    data_row.padding = px(2),
    summary_row.padding = px(3), # A bit more padding for summaries
    row_group.padding = px(4)    # And even more for our groups
  ) %>%
  opt_interactive(
    use_search = TRUE,
    use_filters = TRUE,
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = FALSE,
    use_page_size_select = TRUE
  ) %>%
  cols_width(
    Description ~ px(300)
  )

```
